<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1587px" preserveAspectRatio="none" style="width:2568px;height:1587px;" version="1.1" viewBox="0 0 2568 1587" width="2568px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jj67y1ncidqe" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" filter="url(#f1jj67y1ncidqe)" height="85.118" style="stroke:#000000;stroke-width:2.0;" width="778" x="944" y="1285.1905"/><rect fill="#ADD8E6" height="33.706" style="stroke:none;stroke-width:1.0;" width="778" x="944" y="1336.6026"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="48" x2="48" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="202" x2="202" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="482.5" x2="482.5" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="874" x2="874" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1036" x2="1036" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1186" x2="1186" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1315" x2="1315" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1450" x2="1450" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1618" x2="1618" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1803" x2="1803" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1989" x2="1989" y1="43.0679" y2="1541.1326"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2491.5" x2="2491.5" y1="43.0679" y2="1541.1326"/><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="82" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="12" y="26.9659">Scheduler</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="82" x="5" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="12" y="1562.0986">Scheduler</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="198" x="101" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="108" y="26.9659">SurpriseSimilarityMatrixJob</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="198" x="101" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="108" y="1562.0986">SurpriseSimilarityMatrixJob</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="149" x="406.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="413.5" y="26.9659">RatingMatrixService</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="149" x="406.5" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="413.5" y="1562.0986">RatingMatrixService</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="136" x="804" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="811" y="26.9659">InteractionService</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="136" x="804" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="811" y="1562.0986">InteractionService</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="160" x="954" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="961" y="26.9659">RecommenderService</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="160" x="954" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="961" y="1562.0986">RecommenderService</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="113" x="1128" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="1135" y="26.9659">DatasetFactory</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="113" x="1128" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="1135" y="1562.0986">DatasetFactory</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="117" x="1255" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="1262" y="26.9659">ModelManager</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="117" x="1255" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="1262" y="1562.0986">ModelManager</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="125" x="1386" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1393" y="26.9659">SimilarityService</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="125" x="1386" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1393" y="1562.0986">SimilarityService</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="183" x="1525" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="1532" y="26.9659">RecommenderRepository</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="183" x="1525" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="1532" y="1562.0986">RecommenderRepository</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="159" x="1722" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="1729" y="26.9659">InteractionRepository</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="159" x="1722" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="1729" y="1562.0986">InteractionRepository</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="121" x="1927" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="1934" y="26.9659">RecSysApiClient</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="121" x="1927" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="1934" y="1562.0986">RecSysApiClient</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="130" x="2424.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="2431.5" y="26.9659">ResSysApiService</text><rect fill="#FEFECE" filter="url(#f1jj67y1ncidqe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="130" x="2424.5" y="1540.1326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="2431.5" y="1562.0986">ResSysApiService</text><polygon fill="#A80036" points="190,72.7739,200,76.7739,190,80.7739,194,76.7739" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="48" x2="196" y1="76.7739" y2="76.7739"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="55" y="70.9649">execute()</text><polygon fill="#A80036" points="862,104.4799,872,108.4799,862,112.4799,866,108.4799" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="868" y1="108.4799" y2="108.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="209" y="102.6709">find_all()</text><polygon fill="#A80036" points="1791.5,136.186,1801.5,140.186,1791.5,144.186,1795.5,140.186" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="874" x2="1797.5" y1="140.186" y2="140.186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="881" y="134.377">find(page_size=5_000)</text><polygon fill="#A80036" points="1977.5,167.892,1987.5,171.892,1977.5,175.892,1981.5,171.892" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1803.5" x2="1983.5" y1="171.892" y2="171.892"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="1810.5" y="166.083">Get paginated interactions.</text><polygon fill="#A80036" points="2479.5,199.598,2489.5,203.598,2479.5,207.598,2483.5,203.598" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1989.5" x2="2485.5" y1="203.598" y2="203.598"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="1996.5" y="197.789">GET /api/interacitons?offset=0&amp;limit=5_000 ...</text><polygon fill="#A80036" points="2000.5,231.304,1990.5,235.304,2000.5,239.304,1996.5,235.304" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1994.5" x2="2490.5" y1="235.304" y2="235.304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="2006.5" y="229.495">Interactions Page</text><polygon fill="#A80036" points="1814.5,263.01,1804.5,267.01,1814.5,271.01,1810.5,267.01" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1808.5" x2="1988.5" y1="267.01" y2="267.01"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="1820.5" y="261.201">Interactions Page</text><polygon fill="#A80036" points="885,294.716,875,298.716,885,302.716,881,298.716" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="879" x2="1802.5" y1="298.716" y2="298.716"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="891" y="292.907">Interactions List</text><polygon fill="#A80036" points="213,326.4221,203,330.4221,213,334.4221,209,330.4221" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="207" x2="873" y1="330.4221" y2="330.4221"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="219" y="324.6131">interactions_df: DataFrame(user_id, item_id, rating)</text><polygon fill="#A80036" points="471,358.1281,481,362.1281,471,366.1281,475,362.1281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="477" y1="362.1281" y2="362.1281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="209" y="356.3191">create(interactions_df): Build ratings matrix</text><polygon fill="#A80036" points="862,389.8341,872,393.8341,862,397.8341,866,393.8341" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="483" x2="868" y1="393.8341" y2="393.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="490" y="388.0251">filter_by_rating_scale(interactions_df)</text><polygon fill="#A80036" points="494,421.5401,484,425.5401,494,429.5401,490,425.5401" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="488" x2="873" y1="425.5401" y2="425.5401"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="500" y="419.7311">interactions_df</text><polygon fill="#A80036" points="862,453.2461,872,457.2461,862,461.2461,866,457.2461" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="483" x2="868" y1="457.2461" y2="457.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289" x="490" y="451.4371">filter_users_by_min_interactions(interactions_df)</text><polygon fill="#A80036" points="494,484.9521,484,488.9521,494,492.9521,490,488.9521" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="488" x2="873" y1="488.9521" y2="488.9521"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="500" y="483.1431">interactions_df</text><polygon fill="#A80036" points="862,516.6582,872,520.6582,862,524.6582,866,520.6582" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="483" x2="868" y1="520.6582" y2="520.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="490" y="514.8492">unrated_user_item(interactions_df)</text><polygon fill="#A80036" points="494,548.3642,484,552.3642,494,556.3642,490,552.3642" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="488" x2="873" y1="552.3642" y2="552.3642"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="500" y="546.5552">unrated_user_item_df</text><polygon fill="#A80036" points="1174.5,580.0702,1184.5,584.0702,1174.5,588.0702,1178.5,584.0702" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="483" x2="1180.5" y1="584.0702" y2="584.0702"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="490" y="578.2612">create(interactions_df)</text><polygon fill="#A80036" points="494,611.7762,484,615.7762,494,619.7762,490,615.7762" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="488" x2="1185.5" y1="615.7762" y2="615.7762"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="500" y="609.9672">train_dataset</text><polygon fill="#A80036" points="1303.5,643.4822,1313.5,647.4822,1303.5,651.4822,1307.5,647.4822" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="483" x2="1309.5" y1="647.4822" y2="647.4822"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="490" y="641.6732">train(train_dataset, model = SVD / NMF)</text><polygon fill="#A80036" points="1303.5,675.1882,1313.5,679.1882,1303.5,683.1882,1307.5,679.1882" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="483" x2="1309.5" y1="679.1882" y2="679.1882"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="490" y="673.3792">predict(unrated_user_item_df)</text><polygon fill="#A80036" points="494,706.8943,484,710.8943,494,714.8943,490,710.8943" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="488" x2="1314.5" y1="710.8943" y2="710.8943"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="500" y="705.0853">pred_interactions_df</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483" x2="525" y1="742.6003" y2="742.6003"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="742.6003" y2="755.6003"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484" x2="525" y1="755.6003" y2="755.6003"/><polygon fill="#A80036" points="494,751.6003,484,755.6003,494,759.6003,490,755.6003" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="377" x="490" y="736.7913">all_interactions_df = concat(train_dataset, pred_interactions_df)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483" x2="525" y1="787.3063" y2="787.3063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="787.3063" y2="800.3063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484" x2="525" y1="800.3063" y2="800.3063"/><polygon fill="#A80036" points="494,796.3063,484,800.3063,494,804.3063,490,800.3063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="490" y="781.4973">to_sparse_matrix(all_interactions_df)</text><polygon fill="#A80036" points="213,828.0123,203,832.0123,213,836.0123,209,832.0123" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="207" x2="482" y1="832.0123" y2="832.0123"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="219" y="826.2033">rating_matrix</text><polygon fill="#A80036" points="1438.5,859.7183,1448.5,863.7183,1438.5,867.7183,1442.5,863.7183" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="1444.5" y1="863.7183" y2="863.7183"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="209" y="857.9093">similarities(rating_matrix): Get user similarities</text><polygon fill="#A80036" points="213,891.4243,203,895.4243,213,899.4243,209,895.4243" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="207" x2="1449.5" y1="895.4243" y2="895.4243"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="219" y="889.6153">user_sim_df: Dataframe(user_a, user_b, sim)</text><polygon fill="#A80036" points="1438.5,923.1304,1448.5,927.1304,1438.5,931.1304,1442.5,927.1304" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="1444.5" y1="927.1304" y2="927.1304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="209" y="921.3214">similarities(rating_matrix): Get item similarities</text><polygon fill="#A80036" points="213,954.8364,203,958.8364,213,962.8364,209,958.8364" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="207" x2="1449.5" y1="958.8364" y2="958.8364"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263" x="219" y="953.0274">item_sim_df: Dataframe(item_a, item_b, sim)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="244" y1="990.5424" y2="990.5424"/><line style="stroke:#A80036;stroke-width:1.0;" x1="244" x2="244" y1="990.5424" y2="1003.5424"/><line style="stroke:#A80036;stroke-width:1.0;" x1="203" x2="244" y1="1003.5424" y2="1003.5424"/><polygon fill="#A80036" points="213,999.5424,203,1003.5424,213,1007.5424,209,1003.5424" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="209" y="984.7334">user_sim_df.filter(n_most_similars)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="244" y1="1035.2484" y2="1035.2484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="244" x2="244" y1="1035.2484" y2="1048.2484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="203" x2="244" y1="1048.2484" y2="1048.2484"/><polygon fill="#A80036" points="213,1044.2484,203,1048.2484,213,1052.2484,209,1048.2484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="209" y="1029.4394">item_sim_df.filter(n_most_similars)</text><polygon fill="#A80036" points="1024,1075.9544,1034,1079.9544,1024,1083.9544,1028,1079.9544" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="1030" y1="1079.9544" y2="1079.9544"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="362" x="209" y="1074.1454">upsert('rec-name', user_sim_df, item_sim_df) a recommender</text><polygon fill="#A80036" points="1606.5,1107.6604,1616.5,1111.6604,1606.5,1115.6604,1610.5,1111.6604" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1036" x2="1612.5" y1="1111.6604" y2="1111.6604"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="1043" y="1105.8514">find(name='rec-name')</text><polygon fill="#A80036" points="1977.5,1139.3665,1987.5,1143.3665,1977.5,1147.3665,1981.5,1143.3665" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1618.5" x2="1983.5" y1="1143.3665" y2="1143.3665"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="1625.5" y="1137.5575">Get recommender by name.</text><polygon fill="#A80036" points="2479.5,1171.0725,2489.5,1175.0725,2479.5,1179.0725,2483.5,1175.0725" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1989.5" x2="2485.5" y1="1175.0725" y2="1175.0725"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="1996.5" y="1169.2635">GET /api/recommenders?name=rec-name</text><polygon fill="#A80036" points="2000.5,1202.7785,1990.5,1206.7785,2000.5,1210.7785,1996.5,1206.7785" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1994.5" x2="2490.5" y1="1206.7785" y2="1206.7785"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="2006.5" y="1200.9695">recommender</text><polygon fill="#A80036" points="1629.5,1234.4845,1619.5,1238.4845,1629.5,1242.4845,1625.5,1238.4845" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1623.5" x2="1988.5" y1="1238.4845" y2="1238.4845"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="1635.5" y="1232.6755">recommender</text><polygon fill="#A80036" points="1047,1266.1905,1037,1270.1905,1047,1274.1905,1043,1270.1905" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1041" x2="1617.5" y1="1270.1905" y2="1270.1905"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="1053" y="1264.3815">recommender</text><path d="M944,1285.1905 L1007,1285.1905 L1007,1294.1905 L997,1304.1905 L944,1304.1905 L944,1285.1905 " fill="#FFD700" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="85.118" style="stroke:#000000;stroke-width:2.0;" width="778" x="944" y="1285.1905"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="959" y="1300.0875">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="182" x="1022" y="1298.9494">[if already exist a recommender]</text><polygon fill="#A80036" points="1606.5,1324.6026,1616.5,1328.6026,1606.5,1332.6026,1610.5,1328.6026" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1036" x2="1612.5" y1="1328.6026" y2="1328.6026"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="1043" y="1322.7936">update('rec-name', user_sim_df, item_sim_df, version)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="944" x2="1722" y1="1337.6026" y2="1337.6026"/><polygon fill="#A80036" points="1606.5,1358.3086,1616.5,1362.3086,1606.5,1366.3086,1610.5,1362.3086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1036" x2="1612.5" y1="1362.3086" y2="1362.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="1043" y="1356.4996">add('rec-name', user_sim_df, item_sim_df)</text><polygon fill="#A80036" points="1606.5,1397.0146,1616.5,1401.0146,1606.5,1405.0146,1610.5,1401.0146" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1036" x2="1612.5" y1="1401.0146" y2="1401.0146"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="1043" y="1395.2056">add/update('rec-name', user_sim_df, item_sim_df, version)</text><polygon fill="#A80036" points="1977.5,1428.7206,1987.5,1432.7206,1977.5,1436.7206,1981.5,1432.7206" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1618.5" x2="1983.5" y1="1432.7206" y2="1432.7206"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="1625.5" y="1426.9116">add/update recommender</text><polygon fill="#A80036" points="2479.5,1460.4266,2489.5,1464.4266,2479.5,1468.4266,2483.5,1464.4266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1989.5" x2="2485.5" y1="1464.4266" y2="1464.4266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="478" x="1996.5" y="1458.6176">POST or PUT /api/recommenders {'rec-name', user_sim_df, item_sim_df, version}</text><polygon fill="#A80036" points="213,1474.4266,203,1478.4266,213,1482.4266,209,1478.4266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="207" x2="1035" y1="1478.4266" y2="1478.4266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="244" y1="1510.1326" y2="1510.1326"/><line style="stroke:#A80036;stroke-width:1.0;" x1="244" x2="244" y1="1510.1326" y2="1523.1326"/><line style="stroke:#A80036;stroke-width:1.0;" x1="203" x2="244" y1="1523.1326" y2="1523.1326"/><polygon fill="#A80036" points="213,1519.1326,203,1523.1326,213,1527.1326,209,1523.1326" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="209" y="1504.3236">Finish Job</text><!--MD5=[b7e1530d7ea9aea9bb1fc55b69d31ff4]
@startuml User-User / Item-Item Similarity Matrix prediction Diagram
participant Scheduler order 1
participant SurpriseSimilarityMatrixJob order 2
participant RatingMatrixService order 3
participant InteractionService order 4
participant RecommenderService order 5
participant DatasetFactory order 6
participant ModelManager order 7
participant SimilarityService order 8
participant RecommenderService order 9

participant RecommenderRepository order 10
participant InteractionRepository order 11



participant RecSysApiClient order 20
participant ResSysApiService order 21


Scheduler->SurpriseSimilarityMatrixJob: execute()
SurpriseSimilarityMatrixJob->InteractionService: find_all()
InteractionService->InteractionRepository:find(page_size=5_000)
InteractionRepository->RecSysApiClient: Get paginated interactions.
RecSysApiClient->ResSysApiService: GET /api/interacitons?offset=0&limit=5_000 ...

RecSysApiClient<- -ResSysApiService: Interactions Page
InteractionRepository<- -RecSysApiClient: Interactions Page
InteractionService<- -InteractionRepository: Interactions List
SurpriseSimilarityMatrixJob<- -InteractionService: interactions_df: DataFrame(user_id, item_id, rating)


SurpriseSimilarityMatrixJob->RatingMatrixService: create(interactions_df): Build ratings matrix


RatingMatrixService->InteractionService: filter_by_rating_scale(interactions_df)
RatingMatrixService<- -InteractionService: interactions_df

RatingMatrixService->InteractionService: filter_users_by_min_interactions(interactions_df)
RatingMatrixService<- -InteractionService: interactions_df

RatingMatrixService->InteractionService: unrated_user_item(interactions_df)
RatingMatrixService<- -InteractionService: unrated_user_item_df

RatingMatrixService->DatasetFactory: create(interactions_df)

RatingMatrixService<- -DatasetFactory: train_dataset

RatingMatrixService- ->ModelManager: train(train_dataset, model = SVD / NMF)

RatingMatrixService- ->ModelManager: predict(unrated_user_item_df)

RatingMatrixService<- -ModelManager: pred_interactions_df

RatingMatrixService->RatingMatrixService: all_interactions_df = concat(train_dataset, pred_interactions_df)

RatingMatrixService->RatingMatrixService: to_sparse_matrix(all_interactions_df)

SurpriseSimilarityMatrixJob<- -RatingMatrixService: rating_matrix

SurpriseSimilarityMatrixJob->SimilarityService: similarities(rating_matrix): Get user similarities
SurpriseSimilarityMatrixJob<- -SimilarityService: user_sim_df: Dataframe(user_a, user_b, sim)

SurpriseSimilarityMatrixJob->SimilarityService: similarities(rating_matrix): Get item similarities
SurpriseSimilarityMatrixJob<- -SimilarityService: item_sim_df: Dataframe(item_a, item_b, sim)

SurpriseSimilarityMatrixJob->SurpriseSimilarityMatrixJob: user_sim_df.filter(n_most_similars)
SurpriseSimilarityMatrixJob->SurpriseSimilarityMatrixJob: item_sim_df.filter(n_most_similars)

SurpriseSimilarityMatrixJob->RecommenderService: upsert('rec-name', user_sim_df, item_sim_df) a recommender
RecommenderService->RecommenderRepository: find(name='rec-name')
RecommenderRepository->RecSysApiClient: Get recommender by name.
RecSysApiClient->ResSysApiService: GET /api/recommenders?name=rec-name

RecSysApiClient<- -ResSysApiService: recommender
RecommenderRepository<- -RecSysApiClient: recommender
RecommenderService<- -RecommenderRepository: recommender

alt#Gold #LightBlue if already exist a recommender
    RecommenderService->RecommenderRepository: update('rec-name', user_sim_df, item_sim_df, version)
else
    RecommenderService->RecommenderRepository: add('rec-name', user_sim_df, item_sim_df)
end
RecommenderService->RecommenderRepository: add/update('rec-name', user_sim_df, item_sim_df, version)
RecommenderRepository->RecSysApiClient: add/update recommender
RecSysApiClient->ResSysApiService: POST or PUT /api/recommenders {'rec-name', user_sim_df, item_sim_df, version}
SurpriseSimilarityMatrixJob<- -RecommenderService

SurpriseSimilarityMatrixJob->SurpriseSimilarityMatrixJob: Finish Job
@enduml

PlantUML version 1.2021.00(Sun Jan 10 07:25:05 ART 2021)
(MIT source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>